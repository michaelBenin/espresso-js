(function(espresso,$,espressoConfig,ctx){function namespace(a,b){if(!a)return a;var c=a instanceof Array?a:a.split("."),d=b||window,e;while(e=c.shift())if(!d[e]||!(d=d[e]))d=d[e]={};return d}function flatten(a){function b(a,b){var c;return $.map(b,function(b){c=c||b===a}),c}function c(a){return a!==ctx}function d(a,e,f,g){var h;e=e||{},f=f||[],g=g||[];for(var i in a)h=a[i],f.push(i),typeof h=="object"&&c(h)&&!b(h,g)?g.push(h)&&d(h,e,f,g)&&g.pop():e[f.join(".")]=h,f.pop();return e}return d(a)}function parseConfig(a){function b(a,c){for(var d in a)typeof a[d]=="object"?b(a[d],c):a[d]=typeof a[d]=="string"?substitute(a[d],c):a[d];return a}return b($.extend(!0,{},a),flatten(a))}function constant(a,b,c){return c=c||localConstants,b?(typeof c[a=a.toUpperCase()]=="undefined"&&(c[a]=b),c[a]):c[a]}function which(){for(var a=0;a<arguments.length;++a)if(arguments[a])return arguments[a]}function trim(a){return a.replace(/^\s*|\s*$/g,"")}function lambda(a){return function(){return a}}function capitalize(a,b){return a.replace(b?/^[a-z]/gi:/(?:\s|^)[a-z]/gi,function(a){return a.toUpperCase()})}function substitute(a,b){return a.replace(/{(.+?)}/g,function(a,c){return b[c]||""})}function curry(a,b,c){return function(){return a.apply(c||this,b||[])}}function die(a){if(arguments.length>1)error.apply(null,arguments);else throw new Error(a)}function assign(a,b,c,d){var e=(a=a.split(".")).pop(),f=namespace(a,c);return d?f[e]=f[e.toUpperCase()]=f[capitalize(e)]=b:f[e]=b}function extend(){var a=arguments[0]||{},b=1,c=arguments.length,d=!1,e;typeof a=="boolean"&&(d=a,a=arguments[1]||{},b=2),typeof a!="object"&&!jQuery.isFunction(a)&&(a={}),c==b&&(a=this,--b);for(;b<c;b++)if((e=arguments[b])!=null){for(var f in e){var g=a[f],h=e[f];if(a===h)continue;d&&h&&typeof h=="object"&&!h.nodeType?a[f]=extend(d,g||(h.length!=null?[]:{}),h):h!==undefined&&(a[f]=h)}e.hasOwnProperty("toString")&&(a.toString=e.toString),e.hasOwnProperty("valueOf")&&(a.valueOf=e.valueOf)}return a}function ready(){arguments.length==1?$(arguments[0]):(readyEvents||(readyEvents=new espresso.util.EventManager({autofire:!0}))).listen.apply(readyEvents,arguments)}function objectExists(a,b){if(!a)return a;var c=a instanceof Array?a:a.split("."),d=b||window,e;while(e=c.shift()){if(!d[e])return!1;d=d[e]}return!0}function configure(a){return typeof a=="string"?a=flatten(config)[a]:a=a?$.extend(!0,config,a):$.extend(!0,{},config),a.jQueryNoConflict&&$.noConflict(!0),a}function args(a){return Array.prototype.slice.call(a||arguments.callee.caller.arguments)}function use(packages,callback,loader){function done(){queue.pop().apply(null,args)}function toBool(a){return a!=!1?a!="false":!!a}function decide(condition,fail,pass){if(typeof condition!="undefined")if(typeof condition=="string")try{if(!eval(condition.replace(constant("R_USE_NO_INVOKE"),"")))return fail}catch(e){}else if(!condition)return fail;return pass}var cfg=$.extend(!0,{},config.loader,loader||{}),queue=[],args=[];packages=$.map([].concat(packages),function(a,b){var c=$.extend(!0,{},cfg);return a.replace(constant("R_USE_ATTRS"),function(a,b){var d=b.split("=");c[d[0]]=d[1]||!0}),c=parseConfig(c),a=a.replace(constant("R_USE_REMOVE_STAR"),"").replace(constant("R_USE_PATH"),"$1"),queue.push(b==0?callback||$.noop:$.noop),decide(c.condition,done,function(){var d=c.alias||a,e=objectExists(d),f=[(c.libPath||c.classPath).replace(constant("R_USE_ADD_SLASH"),"/"),a.replace(constant("R_USE_DOT"),"/").replace(constant(toBool(c.prefix)?"R_USE_LAST_SLASH":"R_USE_NOTHING"),"/"+(c.prefix||"")+"$1"),toBool(c.version)?c.versionSuffix:"",toBool(c.withDependencies)?c.depsSuffix:"",toBool(c.minify)?c.minifySuffix:"",".js"].join("");args[b]=namespace(d),!c.force&&(used[f]||e)&&!args[b].__pending__?done():(args[b].__pending__=!0,$.getScript(f,function(){args[b]=used[f]=namespace(d),args[b].__pending__=undefined,delete args[b].__pending__,pending[d]?pending[d].ready=done:done()}))})});while(packages.length)packages.shift()();return args.length==1?args[0]:args}function report(a,b,c,d,e){log(substitute(constant("LOGGING_TPL"),{type:a,task:d,klass:b,method:c,message:e}))}function error(a,b,c,d){throw new Error(substitute(constant("LOGGING_TPL"),{type:"ERROR",task:c,klass:a,method:b,message:d}))}function log(){Array.prototype.shift.call(arguments)>=config.debug.logging&&(ctx.console&&ctx.console.log||$.noop).apply(ctx.console||null,arguments)}function logger(a){return ctx.console?ie?ctx.console.log:a:$.noop}function copy(a){return function(){return a.apply(this,arguments)}}function createClass(){return typeof arguments[0]!="string"&&Array.prototype.unshift.apply(arguments,[null]),lang.Class.create.apply(lang.Class,arguments)}function assignAll(a){$.each(a,assign)}function instanceOf(a,b){return a.instanceOf&&a.instanceOf(b)}function vector(){var a=[];return espresso.$.each(args(),function(b,c){a[c[0]]=c[1]}),a}var VERSION="0.4.0",config=extend(!0,{context:ctx,jQuery:$,jQueryNoConflict:!1,environment:"prod",loader:{classPath:"/",prefix:"",minifySuffix:".min",minify:!1,depsSuffix:".all",version:"",versionSuffix:"-{version}",withDependencies:!1,alias:"",force:!1},debug:{logging:0}},espressoConfig||{}),constants={},localConstants={},used={},pending={},readyEvents,ie=$.browser.msie;constant("LOGGING_TPL","[{type}] in {klass}#{method}: {task}: {message} - Espresso"),constant("R_FUNC_NAME",/(?:function\s+((?:\w|\$)+)(?:\n|.)*)|(?:\n|.)*/),constant("R_USE_ATTRS",/@(\w*(?:=[^\s]*)*)/g),constant("R_USE_REMOVE_STAR",/(?:\.\*)/),constant("R_USE_PATH",/^([0-9A-Za-z.]*).*/),constant("R_USE_NO_INVOKE",/(?:\(+[^)]*\))|(?:[^= ]+=+[^;]+)/g),constant("R_USE_ADD_SLASH",/\/$|$/),constant("R_USE_DOT",/\./g),constant("R_USE_LAST_SLASH",/\/(\w*)$/),constant("R_USE_NOTHING",/^$/),espresso=assign("espresso",espresso||{},this,!0),$||error("espresso","(main)","Checking jQuery Dependency","jQuery dependency not found"),log.curry=function(a){return function(){log.apply(null,[a||0].concat(Array.prototype.slice.call(arguments)))}};var lang=espresso.lang={Namespace:{create:namespace},Error:{create:function(a,b,c){var d=(a=a.split(".")).pop();return namespace(a,c)[d]=function(){var a={};return $.each(arguments,function(b,c){a[b]=c}),Error(substitute(b,a))}}},Class:{alias:function(a,b,c,d){var e=(a=a.split(".")).pop();return namespace(a,d)[e]=function(a){return c&&c(a),new b(a)}},create:function(a,b,c,d){function m(){return function(c){if(h.Singleton&&l)return l;if(!!c||this instanceof arguments.callee){var d=b.apply(this,[$])||{},f;e=this,e.__constructors__=[],e.__parents__=[],e.__classID__=e.__classID__||a,typeof j=="string"&&(j=namespace(j.replace(constant("R_USE_PATH"),"$1"))),i&&!c?error("espresso.lang.Class","create","Instantiating class","Cannot instantiate abstract class "+a):j&&extend(!0,j.apply(this,[{__child__:d}])||{},d);if(c!==null&&typeof c=="object"&&c.__child__){for(var k in i)typeof i[k]=="function"&&!c.__child__[k]&&error("espresso.lang.Class","create","Validating implementation of abstract class","Method "+a+"@"+k+" must be implemented.");e.__constructors__.push({konstructor:d[g]||$.noop,name:g}),e.__parents__.push(a),c.__child__["@parent"]=function(a){return d[a]?d[a].apply(d,Array.prototype.shift.apply(arguments)&&arguments):d[(""+arguments.callee.caller).replace(constant("R_FUNC_NAME"),"$1")].apply(d,arguments)}}else{f=function(){var a=e.__constructors__,b=[g];for(var c=0;c<a.length;++c)b.push(a[c].name);return b}(),extend(!0,e,d)["@super"]=function(){return e.__constructors__.pop().konstructor.apply(e,arguments)},(d[g]||$.noop).apply(e,arguments);for(var m=0;m<f.length;++m)delete e[f[m]];e.__parents__.push(a),e.__setParents(e.__parents__).__setClassID(e.__classID__).__clean(g).__cleanAll(),h.Singleton&&(l=e)}return extend(!0,e,d)}return new arguments.callee}}var e,f=a?a.split("."):["[anonymous]"],g=f.pop(),h=c||{},i=h.Abstract,j=h.Extends||lang.Object,k=[].concat(typeof j=="string"?j:[],h.Dependencies||[]),l=null;return k.length&&(pending[a]=extend(!0,pending[a]||{},{dependencies:k}),use(k,function(){pending[a]&&pending[a].ready&&pending[a].ready(),pending[a]=null,delete pending[a]})),a?namespace(f,d)[g]=m():m()}},Interface:{create:function(a,b){return lang.Class.create(a,$.noop,{Abstract:b})}},Package:{use:function(a,b,c){return use(a,typeof b=="function"?b:function(){readyEvents&&readyEvents.fire(b)},c)}}};lang.Class.create("espresso.lang.Object",function(a){var b,c;return{Object:function(){},__setParents:function(a){return c=a||[],this},__setClassID:function(a){return b=a,this},__clean:function(a){return this[a]=undefined,delete this[a],this},__cleanAll:function(){var a=["__parents__","__setParents","__constructors__","__classID__","__setClassID","@super","__cleanAll","__clean"],b;while(b=a.shift())this.__clean(b);return this},getClassID:function(){return b},instanceOf:function(b){return a.inArray(typeof b=="string"?b:b.getClassID(),c)>-1}}}),assignAll({"espresso.constant":function(a,b){return constant(a,b,constants)},"espresso.jQuery":$,"espresso.$":$,"espresso.load":$.getScript,"espresso.log":logger(log),"espresso.debug":logger(log.curry(0)),"espresso.warn":logger(log.curry(1)),"espresso.error":logger(log.curry(2)),"espresso.trace":logger(log.curry(3)),"espresso.report":report,"espresso.args":args,"espresso.curry":curry,"espresso.copy":copy,"espresso.lambda":lambda,"espresso.vector":vector,"espresso.reflect":curry(flatten,[espresso]),"espresso.ready":ready,"espresso.die":die,"espresso.flatten":flatten,"espresso.which":which,"espresso.extend":extend,"espresso.substitute":substitute,"espresso.capitalize":capitalize,"espresso.trim":trim,"espresso.objectExists":objectExists,"espresso.instanceOf":instanceOf,"espresso.config":configure,"espresso.parseConfig":parseConfig,"espresso.require":lang.Package.use,"espresso.use":lang.Package.use,"espresso.version":lambda(VERSION),"espresso.Static":assign,"espresso.Class":createClass,"espresso.Namespace":lang.Namespace.create,"espresso.Package":lang.Namespace.create,"espresso.Error":lang.Error.create,"espresso.Alias":lang.Class.alias,"espresso.Interface":lang.Interface.create,"espresso.plugins":{}})})(this.espresso,this.jQuery,this.espressoConfig,this),function(a){a.Static("espresso.util.Config.DefaultEnvironments",{PROD:"prod",DEV:"dev"}),a.Static("espresso.util.Config.LoggingLevels",{DEBUG:0,WARN:1,ERROR:2})}(this.espresso),function(a){a.Interface("espresso.util.TwoDIterator",{left:function(){},right:function(){},up:function(){},down:function(){},upleft:function(){},upright:function(){},downleft:function(){},downright:function(){}}),a.Class("espresso.util.EventManager",function(b){function f(b,d){var e=new a.collections.EventQueue(d);return c.put(b,e),e}var c,d,e={autofire:!1};return{EventManager:function(f){b.extend(e,f),c=new a.collections.HashMap,d=new a.collections.HashMap},listen:function(a,b,g){var h=c.get(a),i;return h?(h.add(b,g),e.autofire&&h.hasFired()&&(i=d.get(a),h.flush(i.args,i.scope))):f(a,b),this},fire:function(a,b,e,g){var h=c.get(a);return h||(h=f(a)),h.flush(b,e,g),d.put(a,{args:b,scope:e}),this}}})}(this.espresso),function(a){function b(){}a.Interface("espresso.collections.List",{add:b,get:b,remove:b,size:b,isEmpty:b}),a.Class("espresso.collections.LinkedList",function(b){var c;return{LinkedList:function(a){c=a||[]},size:function(){return c.length},add:function(b,d){if(d==null)return c.push(b),this.size()-1;if(d<0||d>=_size())throw new a.collections.LinkedList.IndexOutOfBoundsException(d);return c.splice(d,0,b),d},get:function(b){if(b<0||b>=this.size())throw new a.collections.LinkedList.IndexOutOfBoundsException(b);return c[b]},replace:function(b,d){if(d<0||d>=this.size())throw new a.collections.LinkedList.IndexOutOfBoundsException(d);c[d]=b},remove:function(b){if(b<0||b>=this.size())throw new a.collections.LinkedList.IndexOutOfBoundsException(b);c.splice(b,1)},getFirst:function(){if(this.isEmpty())throw new a.collections.LinkedList.NoSuchElementException;return this.get(0)},getLast:function(){if(this.isEmpty())throw new a.collections.LinkedList.NoSuchElementException;return this.get(this.size()-1)},isEmpty:function(){return this.size()==0},clear:function(){var a=this.size();a>0&&c.splice(0,a)},toArray:function(){return c.slice(0)},clone:function(){return new a.collections.LinkedList(this.isEmpty()?null:this.toArray())}}},{Extends:a.collections.List}),a.Error("espresso.collections.LinkedList.IndexOutOfBoundsException","Index {0} out of bounds on espresso.collections.LinkedList object"),a.Error("espresso.collections.LinkedList.NoSuchElementException","No such element exists on espresso.collections.LinkedList object."),a.Class("espresso.collections.SparsedMatrix",function(a){function f(a,b){return[a,b].join(",")}function g(a,b){function c(a,b){return function(){return h(a,b)}}return{up:c(a,b-1),left:c(a-1,b),down:c(a,b+1),right:c(a+1,b),upright:c(a+1,b-1),upleft:c(a-1,b-1),downright:c(a+1,b+1),downleft:c(a-1,b+1),current:c(a,b)}}function h(a,b){return d[f(a,b)]||i(a,b)}function i(a,b,c){var g=f(a,b),h=d[g];return h||++e,d[g]=new m(a,b,c||null)}function j(a,b){c=g(a,b)}function k(){j(0,0)}function l(a){return function(){return b.move.call(b,a)}}function m(a,b,c){this.x=a,this.y=b,this.data=c}var b,c,d,e;return{SparsedMatrix:function(){b=this.clear()},get:function(a,b){return arguments.length==0?c.current().data:h(a,b).data},set:function(a,b,d){var e;return arguments.length<=1?(d=arguments[0],e=c.current(),a=e.x,b=e.y):j(a,b),i(a,b,d),this},clear:function(){return d={},e=0,k(),this},length:function(){return e},position:function(){var a=c.current();return{x:a.x,y:a.y}},move:function(a,b){var d;return arguments.length==1&&(d=c[arguments[0]](),a=d.x,b=d.y),j(a,b),this},toString:function(){var a=[];for(var b in a)a.push("{"+b+"}");return["Length: "+e,"Iterator: "+(e?"{"+c.current().x+","+c.current().y+"}":"null"),"Nodes: "+a.join(", ")].join("\n")},debug:function(a){a&&(a("Length",e),a("Iterator",e?{x:c.current().x,y:c.current().y}:null),a("Nodes",d))},up:l("up"),left:l("left"),down:l("down"),right:l("right"),upright:l("upright"),upleft:l("upleft"),downright:l("downright"),downleft:l("downleft")}},{Extends:a.util.TwoDIterator}),a.Static("espresso.collections.SparsedMatrix.DirectionsEnum",{UP:"up",LEFT:"left",DOWN:"down",RIGHT:"right",UP_LEFT:"upleft",UP_RIGHT:"upright",DOWN_LEFT:"downleft",DOWN_RIGHT:"downright"}),a.Class("espresso.collections.HashMap",function(b){function g(a,b){var c=e.add(a);f.add(b),d[a]=c}function h(a,b){var c=d[a];f.replace(b,c)}var c=this,d={},e,f;return{HashMap:function(){var b=a.collections.LinkedList;return e=new b,f=new b,this},put:function(a,b){return d[a]?h(a,b):g(a,b),b},add:function(a,b){return this.put(a,b)},get:function(a){var b=d[a];return b==null?null:f.get(b)},remove:function(a){if(!d[a])return this;var b=d[a];return delete d[a],e.remove(b),f.remove(b),this},clear:function(){for(var a in d)delete d[a];e.clear(),f.clear()},getKeys:function(){return e.clone()},getValues:function(){return f.clone()},size:function(){return e.size()},isEmpty:function(){return this.size()==0}}},{Extends:a.collections.List}),a.Class("espresso.collections.EventQueue",function(b){function e(b){if(c.length)return c[b]()();throw new a.collections.EventQueue.QueueDepletedException}var c,d=!1;return{EventQueue:function(a){c=[],this.add(a)},add:function(a,b){if(a instanceof Array)for(var d=0;d<a.length;++d)this.add(a[d]);else typeof a=="function"&&c[b?"unshift":"push"](a);return this},flush:function(a,b,e){var f=c,g;e&&(f=[].concat(c));while(g=f.shift())g.apply(b,a instanceof Array?a:[a]);return d=!0,this},step:function(){return e("shift")},pop:function(){return e("pop")},length:function(){return c.length},hasFired:function(){return d}}}),a.Error("espresso.collections.EventQueue.QueueDepletedException","The queue is empty. Nothing to execute.")}(this.espresso),function(a){function e(a){return a||{}}var b=a.$;a.Class("espresso.framework.Session",function(a){return{Session:function(){}}}),a.Class("espresso.framework.Process",function(b){var c,d,e,f,g;return{Process:function(a,b,h){g=this,d=b,e=h,f=a,c=f.processes().add(this)},invoke:function(c){var h;return f.getApplicationWorker((d=d.split(".")).shift(),function(i){c=c||{},i=a.Namespace(d.join("."),i)||i,h=i[e].apply(i,[].concat(c.args||[]))||new a.framework.ProcessResult,h.process(g),h.state(a.framework.Process.COMPLETE),(c.callback||b.noop)(h),f.processes().remove(this)}),h},path:function(){return d},command:function(){return e},toString:function(){return""+c},valueOf:function(){return 1*c}}}),a.Static("espresso.framework.Process.READY",0),a.Static("espresso.framework.Process.COMPLETE",1),a.Class("espresso.framework.collections.Processes",function(a){var b,c;return{Processes:function(){b={},c=[]},add:function(a){var d=c.push([a.path(),a.command()]);return b[d]=a,d},remove:function(a){b[a]=undefined,delete b[a]}}}),a.Class("espresso.framework.ProcessResult",function(b){function d(a,b){return c[a]=typeof b!="undefined"?b:c[a]}var c={};return{ProcessResult:function(b,c){c=c||{},this.value(b),this.state(c.state||a.framework.Process.READY),this.session(c.session),this.assert(c.assert),this.process(c.process)},value:function(a){return d("value",a)},state:function(a){return d("state",a||c.value)},process:function(a){return d("process",a)},session:function(b){return a.extend(c,{session:b}),this},assert:function(b,d){return a.extend(c,{assert:[b,d]}),this}}}),a.Class("espresso.framework.Application",function(b){function k(b){var c=a.parseConfig(b||{}),d=c.registry;for(var e in d)f.put(e,d[e]);c.autoload?l(c.autoload):o()}function l(a){function d(c){return b.map(a,c)}c.use(d(function(a){return f.get(a)}),function(){d(function(a){m(a)}),o()})}function m(d,e){return c.use(f.get(d),function(f){(e||b.noop)(f.getInstance().initialize(c,a.parseConfig(j.applicationWorkers[d])))})}function n(){g.length()&&g.flush()}function o(){c.initialize()}var c,d,e,f,g,h,i,j={};return{Application:function(b,j,l,m){var n=a.collections,o=a.framework;return d=b,e=m,f=new n.HashMap,g=new n.EventQueue,i=new o.Session,h=new o.collections.Processes,c=this.setConfig(j),k(l),this},setConfig:function(b){var c=this.getContext().espressoConfig;return c=a.extend(!0,(b||{}).espresso,this.getContext().espressoConfig),a.config(c),a.extend(!0,j,c||{},b),this},getContext:function(){return e},getConfig:function(){return j},getName:function(){return d},loadApplicationWorker:function(a,b){return m(a,b),this},getApplicationWorker:function(a,b){var c=m(a,b);return typeof c=="function"?c.getInstance():null},use:function(b,c,d){return a.use(b,c,d||j.loader)},domready:function(a){return g.add(a),b(n),this},execute:function(b,c,d){return(new a.framework.Process(this,b,c)).invoke(d)},processes:function(){return h},session:function(){return i}}},{Abstract:{initialize:function(a,b){},ready:function(){}}}),a.Class("espresso.framework.ApplicationWorker",function(b){return{ApplicationWorker:b.noop,registerComponent:function(b,c){return this[a.capitalize(b)]=c,this},hasComponent:function(b){return!!this[a.capitalize(b)]}}},{Abstract:{initialize:function(a,b){}}}),a.Class("espresso.framework.data.DataModel",function(a){function c(a){return a.replace(/(?:_|-)(\w)/g,function(a,b){return b.toUpperCase()})}function d(a){return a.replace(/^(\w)/,function(a,b){return b.toUpperCase()})}function e(e){a.each(e,function(a,e){b[["get",d(c(a))].join("")]=function(){return e}})}var b=null;return{DataModel:function(a){return b=this,e(a),this}}});var c={},d=a.plugins;d.Application={create:function(d,f,g,h){var i=!1,j,k,l,m;return g=e(g),j=e(g.Configuration),k=e(g.ApplicationWorkers),h=h||a.config("context"),(f=f(b))[d]=function(){return this["@super"](d,j.Default||{},k,h)},l=a.copy(f.initialize),f.initialize=function(){return i?this:(i=!0,l.call(this,this.getConfig(),h),this)},m=a.Class(d,function(){return f},{Extends:g.Extends||a.framework.Application,Singleton:!0},h),f=new m,a.Static("getInstance",a.lambda(f),h[d]),c[d]=f.domready(b.proxy(f.ready,f))}},d.ApplicationWorker={create:function(c,d,e){var f=!1,g=a.copy((d=d(b)).initialize),h;return d.initialize=function(){return f?this:(f=!0,g.apply(this,arguments),this)},h=a.Class(c,a.lambda(d),{Extends:(e=e||{}).Extends||a.framework.ApplicationWorker,Dependencies:e.Dependencies,Singleton:!0}),a.Static("getInstance",function(){return new this},h),h}},d.ProcessResult=function(b,c){return new a.framework.ProcessResult(b,c)},a.Static("Application",d.Application.create,a),a.Static("ApplicationWorker",d.ApplicationWorker.create,a),a.Static("getApplication",function(a){return c[a]||null},a),a.Static("ProcessResult",d.ProcessResult,a)}(this.espresso);